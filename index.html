<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Snake Game</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <canvas id="mycanvas" width="400" height="400"></canvas>
    <button type="button" id="playBtn">Play</button>
    <script>
        
        const canvas = document.getElementById("mycanvas")
        const ctx = canvas.getContext("2d")
        const gridSize = 20, totalSize = 20 

        // 위치 관련 변수
        let snakeX = 0, snakeY = 0        // 뱀의 위치 변수
        let appleX = 0, appleY = 0      // 사과 위치 변수
        let snakeArray = [];               // 뱀의 몸통 저장 배열
        let interval;
        let appleCount = 0;               // 먹은 사과 개수
        let direction = "right";          // 뱀이 자동으로 움직일 때 이동 방향(기본값 오른쪽)
    

         // 게임판 설정
         ctx.fillStyle = "black"

        /* fillRect(x, y, width, height) 
        * x,y는 그리려는 사각형의 위치
        * width, height는 그리려는 사각형의 크기
        */
        ctx.fillRect(0, 0, canvas.width, canvas.height) 


        let playBtn = document.getElementById('playBtn');
        playBtn.addEventListener('click', function () {
            gameStart();
        })


        /* 키보드 이벤트 부여 */
        function gameStart(){
            
            document.addEventListener("keydown", keyPush)
            
            interval = setInterval(gamePlay, 300)
        }
        
        
        /* 방향키를 눌렀을 떄 이벤트 함수 */
        function keyPush(e) { 
            switch(e.keyCode) { //e.keyCode -> 현재 눌린 키보드의 키코드 
                case 37:  // 왼쪽
                    if(direction != "right"){direction = "left"}        // 움직이고 있는 방향이 오른쪽일때 왼쪽키로 움직일 수 없도록.
                    break;
                case 39:  // 오른쪽
                    if(direction != "left"){direction = "right"} 
                    break;
                case 38:   // 위
                    if(direction != "down"){direction = "up"} 
                    break;
                case 40:   // 아래
                    if(direction != "up"){direction = "down"} 
                    break;   
            }

            //if(x==appleX && y==appleY){alert("뱀이 사과를 먹었습니다!");x = 0, y = 0}
        }

        /* 랜덤숫자 생성 */
        function randomNum(){
            let ranNum = Math.floor(Math.random()*totalSize);
            return ranNum;
        }
        
        /* 사과 랜덤으로 위치하게 하기 */
        function appleRandom(){
            appleX= randomNum(); 
            appleY = randomNum(); 

        }
        

        function gamePlay(){
            ctx.fillStyle = "black"
            ctx.fillRect(0, 0, canvas.width, canvas.height) 
             // 사과 랜덤으로 뿌리기
             appleDraw();  

            // 뱀 그리기
            snakeDraw();

            // 게임 도중 벽에 부딪혔을 때 Game over
            if( snakeX < 0 || snakeX > (totalSize - 1) || snakeY < 0 || snakeY > (totalSize - 1) ) {    
                gameOver("벽에 부딪혔습니다, Game Over - !");
            }
        }
        
        function autoMove(){
            switch(direction) { 
                case "left":  // 왼쪽
                    snakeX -= 1
                    break;
                case "right":  // 오른쪽
                    snakeX += 1
                    break;
                case "up":   // 위
                    snakeY -= 1
                    break;
                case "down":   // 아래
                    snakeY += 1
                    break;   
            }

        }


        function appleDraw(){
            
            //appleRandom();

            // 사과가 뱀의 위치(0,0)와 겹치거나 || 뱀이 사과를 먹었을 때 
            if( (appleX == 0 && appleY == 0) || (appleX == snakeX && appleY == snakeY) ){   

                if( appleX == snakeX && appleY == snakeY ){
                    appleCount++;
                }

                appleRandom();        
            }
            
            // 3. path 그리기 시작 설정 
            /*ctx.beginPath(); 
            // 4. 원 모양 설정 
            ctx.arc(2, 2, 1, 0, 2*Math.PI); 
            // 5. 그리기 
            ctx.stroke(); 
            // 6. 원 내부 색 채우기 
            ctx.fillStyle = "tomato"
            ctx.fill();*/


            ctx.fillStyle = "tomato"
            ctx.fillRect(appleX * gridSize, appleY * gridSize, gridSize-2, gridSize-2)
        }

        function snakeDraw(){
           
            // 뱀 자동으로 움직이기
           autoMove();
           
           snakeArray.push({
                x : snakeX ,
                y : snakeY
            })

            while(snakeArray.length > appleCount  ) {   // 뱀을 그리는 시점을 확인해봐야 할 듯!
                snakeArray.shift();
            }
            
            ctx.fillStyle = "green";
            for(i = 0; i < snakeArray.length; i++){
                ctx.fillRect(snakeArray[i].x * gridSize, snakeArray[i].y * gridSize, gridSize-2, gridSize-2);
            }


            
        }


        function gameOver(msg){
            let snakeX = 0, snakeY = 0        
            let appleX = 0, appleY = 0      
            let appleCount = 0;              
            let direction = "right";    

            alert(msg);     
            clearInterval(interval);
            location.reload();
        }

        
    </script>

    
</body>


</html>



